##############################################
## Configurando RedHat com Azure CLI
##############################################

https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/deploying_red_hat_enterprise_linux_8_on_public_cloud_platforms/assembly_deploying-a-rhel-image-as-a-virtual-machine-on-microsoft-azure_cloud-content#install-the-azure-cli_deploying-a-virtual-machine-on-microsoft-azure

Import the Microsoft repository key.

$ sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc
Create a local Azure CLI repository entry.

$ sudo sh -c 'echo -e "[azure-cli]\nname=Azure CLI\nbaseurl=https://packages.microsoft.com/yumrepos/azure-cli\nenabled=1\ngpgcheck=1\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc" > /etc/yum.repos.d/azure-cli.repo'
Update the yum package index.

$ yum check-update
Check your Python version (python --version) and install Python 3.x, if necessary.

$ sudo yum install python3
Install the Azure CLI.

$ sudo yum install -y azure-cli
Run the Azure CLI.

$ az

##############################################
## Logando
##############################################

az login

OBS: vai abrir browser onde precisa colocar a senha que esta no console
[root@SudoxHero ~]# az login
To sign in, use a web browser to open the page https://microsoft.com/devicelogin and enter the code FDADYLE4H to authenticate.


##############################################
## Criando arquivo de exemplo para fazer upload
##############################################

mkdir /home/sudoxhero/dump/dump.dmp

https://learn.microsoft.com/en-us/cli/azure/storage/azcopy/blob?view=azure-cli-latest#az-storage-azcopy-blob-upload

Comando para enviar o arquivo para o container

Ex: vai substituir MyContainer pelo nome do container e substituir MyStorageAccount pelo nome do storage account e colocar o caminho do arquivo no parametro -s
az storage azcopy blob upload -c MyContainer --account-name MyStorageAccount -s "path/to/directory" --recursive

Exemplo real abaixo:
az storage azcopy blob upload -c backup --account-name testmongo -s "/home/sudoxhero/dump/dump.dmp" --recursive

Resultado da saida ser√° semelhante a:

[root@SudoxHero dump]# az storage azcopy blob upload -c backup --account-name testmongo -s "/home/sudoxhero/dump/dump.dmp" --recursive          There are no credentials provided in your command and environment, we will query for the account key inside your storage account.
Please provide --connection-string, --account-key or --sas-token as credentials, or use `--auth-mode login` if you have required RBAC roles in your command. For more information about RBAC roles in storage, visit https://docs.microsoft.com/en-us/azure/storage/common/storage-auth-aad-rbac-cli.
Setting the corresponding environment variables can avoid inputting credentials in your command. Please use --help to get more information.
Azcopy command: ['/root/.azure/cliextensions/storage-preview/azext_storage_preview/azcopy/azcopy_linux_amd64_10.5.0/azcopy', 'copy', '/home/sudoxhero/dump/dump.dmp', 'https://testmongo.blob.core.windows.net/backup/?se=2023-01-03T21%3A17%3A13Z&sp=rwdlacup&sv=2018-03-28&ss=b&srt=sco&sig=4gRPiHrv25PP0oNBlqxWJ7N13ptNeyFhInA9iiT/h8M%3D', '--recursive']
INFO: Scanning...
INFO: Any empty folders will not be processed, because source and/or destination doesn't have full folder support

Job 8ff637b3-267b-2043-6ee1-0c787293dc93 has started
Log file is located at: /root/.azcopy/8ff637b3-267b-2043-6ee1-0c787293dc93.log

INFO: azcopy: A newer version 10.16.2 is available to download

0.0 %, 0 Done, 0 Failed, 1 Pending, 0 Skipped, 1 Total,


Job 8ff637b3-267b-2043-6ee1-0c787293dc93 summary
Elapsed Time (Minutes): 0.0333
Number of File Transfers: 1
Number of Folder Property Transfers: 0
Total Number of Transfers: 1
Number of Transfers Completed: 1
Number of Transfers Failed: 0
Number of Transfers Skipped: 0
TotalBytesTransferred: 7
Final Job Status: Completed

[root@SudoxHero dump]#


